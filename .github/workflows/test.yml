name: Jekyll site CI

on: [workflow_dispatch]

jobs:
  build:
  
    runs-on: windows-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        path: master
    - name: Checkout tools repo
      uses: actions/checkout@v3
      with:
        repository: Maksym-Popovkin/git_test
        #token: ${{ secrets.GH_PAT }}
        path: git_test
    - name: Test1
      run: |
        python --version
        py -m pip install pyodbc
        Install-Module -Name PowerShellGet -MinimumVersion 2.0.1 -Force
        Install-Module -Name SqlChangeAutomation -RunAsAdmin
        Import-Module SqlChangeAutomation
    - name: Install a SQL Server suite of tools
      uses: potatoqualitee/mssqlsuite@v1.5.1
      with:
        install: sqlengine, sqlclient, sqlpackage, localdb
    - name: Install Tabular Editor
      run: |
        $TabularEditorUrl = "https://cdn.tabulareditor.com/files/te2/TabularEditor.Portable.zip" 
        $DownloadDestination = join-path (get-location) "TabularEditor.zip"
        Invoke-WebRequest -Uri $TabularEditorUrl -OutFile $DownloadDestination
        Expand-Archive -Path $DownloadDestination -DestinationPath (get-location).Path
        Remove-Item $DownloadDestination
    - name: Test
      run: |
        python --version
        py -m pip install pyodbc
        Install-Module -Name PowerShellGet -MinimumVersion 2.0.1 -Force
        Install-Module -Name SqlChangeAutomation
        Import-Module SqlChangeAutomation

